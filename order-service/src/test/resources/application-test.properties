# ===================================================================
# SPRING DATASOURCE (DataSourceAutoConfiguration & DataSourceProperties)
# ===================================================================
# Test Database Configuration
spring.datasource.url=jdbc:h2:mem:testdb;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MODE=PostgreSQL
spring.datasource.driver-class-name=org.h2.Driver
spring.datasource.username=sa
spring.datasource.password=
spring.datasource.initialization-mode=always
spring.datasource.hikari.maximum-pool-size=10
spring.datasource.hikari.minimum-idle=2

# ===================================================================
# H2 CONSOLE
# ===================================================================
spring.h2.console.enabled=true
spring.h2.console.path=/h2-console
spring.h2.console.settings.web-allow-others=false

# ===================================================================
# JPA / HIBERNATE
# ===================================================================
spring.jpa.hibernate.ddl-auto=create-drop
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.H2Dialect

# Disable Flyway for tests since we're using H2 and the migrations are PostgreSQL-specific
spring.flyway.enabled=false
spring.jpa.properties.hibernate.jdbc.batch_size=20
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true
spring.jpa.properties.hibernate.jdbc.batch_versioned_data=true

# ===================================================================
# SERVER CONFIGURATION
# ===================================================================
server.port=0
server.servlet.session.timeout=30m
server.error.include-message=always
server.error.include-binding-errors=always

# ===================================================================
# SPRING TEST CONFIGURATION
# ===================================================================
spring.test.database.replace=any
spring.test.context.cache.maxSize=32

# ===================================================================
# LOGGING
# ===================================================================
logging.level.root=INFO
logging.level.com.ecommerce=DEBUG
logging.level.org.hibernate.SQL=DEBUG
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=TRACE
logging.level.org.springframework.jdbc=DEBUG
logging.level.org.springframework.transaction=TRACE
logging.level.org.hibernate.validator=WARN
logging.level.org.hibernate.orm.deprecation=WARN

# ===================================================================
# SPRING CLOUD CONFIGURATION
# ===================================================================
# Disable service discovery
eureka.client.enabled=false
spring.cloud.discovery.enabled=false

# ===================================================================
# FEIGN CLIENT CONFIGURATION
# ===================================================================
spring.cloud.openfeign.enabled=false
feign.client.config.default.loggerLevel=basic
feign.client.config.default.logLevel=basic

# ===================================================================
# APPLICATION SPECIFIC CONFIGURATION
# ===================================================================
# Test mode configuration
app.test.mode=true

# Mock external services
product-service.url=http://localhost:8081
inventory-service.url=http://localhost:8082
payment-service.url=http://localhost:8083

# ===================================================================
# KAFKA CONFIGURATION
# ===================================================================
# Kafka topics
kafka.topics.payment-events=payment-events-test
kafka.topics.inventory-events=inventory-events-test
kafka.topics.order-events=order-events-test

# Kafka producer configuration
spring.kafka.bootstrap-servers=localhost:9092
spring.kafka.producer.key-serializer=org.apache.kafka.common.serialization.StringSerializer
spring.kafka.producer.value-serializer=org.springframework.kafka.support.serializer.JsonSerializer
spring.kafka.producer.acks=all
spring.kafka.producer.retries=3
spring.kafka.producer.properties.enable.idempotence=true
spring.kafka.producer.properties.max.in.flight.requests.per.connection=1

# Kafka consumer configuration
spring.kafka.consumer.group-id=order-service-test-group
spring.kafka.consumer.auto-offset-reset=earliest
spring.kafka.consumer.enable-auto-commit=true
spring.kafka.consumer.auto-commit-interval=100ms
spring.kafka.consumer.key-deserializer=org.apache.kafka.common.serialization.StringDeserializer
spring.kafka.consumer.value-deserializer=org.springframework.kafka.support.serializer.JsonDeserializer
spring.kafka.consumer.properties.spring.json.trusted.packages=*
spring.kafka.consumer.properties.spring.json.use.type.headers=false

# ===================================================================
# SCHEDULING CONFIGURATION
# ===================================================================
# Disable scheduling for tests
spring.task.scheduling.enabled=false

# ===================================================================
# CACHING CONFIGURATION
# ===================================================================
spring.cache.type=none

# ===================================================================
# METRICS & ACTUATOR
# ===================================================================
management.endpoints.web.exposure.include=health,info,metrics
management.endpoint.health.show-details=when_authorized
management.endpoint.metrics.enabled=true
management.metrics.export.simple.enabled=true
management.metrics.enable.process.files=false

# ===================================================================
# TEST-SPECIFIC OVERRIDES
# ===================================================================
# Override any test-specific properties here
spring.task.scheduling.enabled=false

# Disable async execution for tests
spring.task.execution.shutdown.await-termination=false
spring.task.execution.shutdown.await-termination-period=0s

# Disable Kafka auto-configuration for tests
spring.autoconfigure.exclude=org.springframework.boot.autoconfigure.kafka.KafkaAutoConfiguration
